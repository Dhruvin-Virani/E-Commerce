{% extends "base/base.html" %}

{% block start %}

<section class="section-content padding-y">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-md-8">
				<div class="card">
					<div class="card-header">
						<h4 class="card-title">Complete Your Payment</h4>
					</div>
					<div class="card-body">
						<div class="mb-4">
							<h5>Order Summary</h5>
							<table class="table table-bordered">
								<tr>
									<td><strong>Order ID:</strong></td>
									<td>{{ payment.razorpay_order_id }}</td>
								</tr>
								<tr>
									<td><strong>Total Amount:</strong></td>
									<td><strong>₹{{ amount_in_rupees }}.00</strong></td>
								</tr>
							</table>
						</div>
						
						<div class="text-center">
							<button id="rzp-button1" class="btn btn-primary btn-lg">Pay ₹{{ amount_in_rupees }}.00</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
	var options = {
		"key": "{{ razorpay_key_id }}",
		"amount": "{{ amount }}",
		"currency": "INR",
		"name": "Ecommerce Store",
		"description": "Order Payment",
		"image": "/media/images/logo.png",
		"order_id": "{{ payment.razorpay_order_id }}",
		"handler": function (response){
			// Submit payment verification via form
			var form = document.createElement('form');
			form.method = 'POST';
			form.action = '{% url "verify_payment" %}';
			
			var csrfToken = document.createElement('input');
			csrfToken.type = 'hidden';
			csrfToken.name = 'csrfmiddlewaretoken';
			csrfToken.value = '{{ csrf_token }}';
			form.appendChild(csrfToken);
			
			var orderId = document.createElement('input');
			orderId.type = 'hidden';
			orderId.name = 'razorpay_order_id';
			orderId.value = response.razorpay_order_id;
			form.appendChild(orderId);
			
			var paymentId = document.createElement('input');
			paymentId.type = 'hidden';
			paymentId.name = 'razorpay_payment_id';
			paymentId.value = response.razorpay_payment_id;
			form.appendChild(paymentId);
			
			var signature = document.createElement('input');
			signature.type = 'hidden';
			signature.name = 'razorpay_signature';
			signature.value = response.razorpay_signature;
			form.appendChild(signature);
			
			document.body.appendChild(form);
			form.submit();
		},
		"prefill": {
			"name": "{{ user_name }}",
			"email": "{{ user_email }}",
			"contact": "{{ user_contact }}"
		},
		"theme": {
			"color": "#3399cc"
		}
	};
	
	var rzp1 = new Razorpay(options);
	document.getElementById('rzp-button1').onclick = function(e){
		rzp1.open();
		e.preventDefault();
	}
</script>

{% endblock %}

